import type { AuthContext, AuthUser } from '../../types/user';
import type { ExploitAddInput } from '../../generated/graphql';
import { createEntity } from '../../database/middleware';
import { notify } from '../../database/redis';
import { BUS_TOPICS } from '../../config/conf';
import { ABSTRACT_STIX_DOMAIN_OBJECT } from '../../schema/general';
import { storeLoadById } from '../../database/middleware-loader';
import type { BasicStoreEntityExploit } from './exploit-types';
import { ENTITY_TYPE_EXPLOIT } from './exploit-types';

export function findById(context: AuthContext, user: AuthUser, id: string): BasicStoreEntityExploit {
  return storeLoadById(context, user, id, ENTITY_TYPE_EXPLOIT) as unknown as BasicStoreEntityExploit;
}

export async function addExploit(context: AuthContext, user: AuthUser, input: ExploitAddInput) {
  const created = await createEntity(context, user, input, ENTITY_TYPE_EXPLOIT);

  return notify(BUS_TOPICS[ABSTRACT_STIX_DOMAIN_OBJECT].ADDED_TOPIC, created, user);
}
