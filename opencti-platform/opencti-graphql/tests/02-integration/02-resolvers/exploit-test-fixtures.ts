import { BasicStoreEntityExploit, ENTITY_TYPE_EXPLOIT } from '../../../src/modules/exploit/exploit-types';
import { createEntity } from '../../../src/database/middleware';
import { ADMIN_USER, testContext } from '../../utils/testQuery';
import {
  ENTITY_TYPE_ATTACK_PATTERN,
  ENTITY_TYPE_CAMPAIGN,
  ENTITY_TYPE_INTRUSION_SET,
  ENTITY_TYPE_MALWARE,
  ENTITY_TYPE_THREAT_ACTOR,
  ENTITY_TYPE_VULNERABILITY
} from '../../../src/schema/stixDomainObject';
import { addMarkingDefinitionWithoutBusNotification } from '../../../src/domain/markingDefinition';

export async function createExploitWithName(name: string): Promise<BasicStoreEntityExploit> {
  return createEntity(
    testContext,
    ADMIN_USER,
    {
      name,
      description: '',
      published_date: '2023-01-16T15:54:59.194Z'
    },
    ENTITY_TYPE_EXPLOIT
  );
}

export async function createAttackPatternWithName(attackPatternName: string) {
  return createEntity(
    testContext,
    ADMIN_USER,
    {
      name: attackPatternName,
      description: '',
      x_mitre_id: '',
      objectLabel: [],
      objectMarking: [],
      killChainPhases: [],
      externalReferences: []
    },
    ENTITY_TYPE_ATTACK_PATTERN
  );
}

export async function createThreatActorWithName(threatActorName: string) {
  return createEntity(
    testContext,
    ADMIN_USER,
    {
      name: threatActorName,
      description: '',
      threat_actor_type: [],
      confidence: 75,
      objectMarking: [],
      objectLabel: [],
      externalReferences: []
    },
    ENTITY_TYPE_THREAT_ACTOR
  );
}

export async function createVulnerabilityWithName(vulnerabilityName: string) {
  return createEntity(
    testContext,
    ADMIN_USER,
    {
      name: vulnerabilityName,
      description: '',
      x_opencti_base_score: 1,
      x_opencti_base_severity: '',
      x_opencti_attack_vector: '',
      confidence: 75,
      objectMarking: [],
      objectLabel: [],
      externalReferences: []
    },
    ENTITY_TYPE_VULNERABILITY
  );
}

export async function createIntrusionSetWithName(name: string) {
  return createEntity(
    testContext,
    ADMIN_USER,
    {
      name,
      description: '',
      confidence: 75,
      objectMarking: [],
      objectLabel: [],
      externalReferences: []
    },
    ENTITY_TYPE_INTRUSION_SET
  );
}

export async function createCampaignWithName(name: string) {
  return createEntity(
    testContext,
    ADMIN_USER,
    {
      name,
      description: '',
      confidence: 75,
      objectMarking: [],
      objectLabel: [],
      externalReferences: []
    },
    ENTITY_TYPE_CAMPAIGN
  );
}

export async function createMalwareWithName(malwareName: string) {
  return createEntity(
    testContext,
    ADMIN_USER,
    {
      name: malwareName,
      description: '',
      malware_types: [],
      is_family: false,
      architecture_execution_envs: [],
      implementation_languages: [],
      confidence: 75,
      objectMarking: [],
      objectLabel: [],
      externalReferences: []
    },
    ENTITY_TYPE_MALWARE
  );
}

export async function createMarking() {
  return addMarkingDefinitionWithoutBusNotification(
    {
      definition_type: 'TLP',
      definition: 'TLP:NOT_CLEAR',
      x_opencti_color: '#000000',
      x_opencti_order: 1,
    },
    testContext,
    ADMIN_USER
  );
}
